Sub StockAnalysis()    For Each ws In ThisWorkbook.Worksheets        Dim Ticker As String        Dim YearlyChange As Double        Dim PercentChange As Double        Dim TotalVolume As Double        Dim LastRow As Long        Dim SummaryRow As Long        Dim OpeningPrice As Double        Dim ClosingPrice As Double        Dim Ticker_Name_Total As Double        Ticker_Name_Total = 0        Dim Max_Ticker_Name As String        Max_Ticker_Name = "  "        Dim Min_Ticker_Name As String        Min_Ticker_Name = "  "        Dim Max_Percent As Double        Max_Percent = 0        Dim Min_Percent As Double        Min_Percent = 0        Dim Max_Volume_Ticker_Name As String        Max_Volume_Ticker_Name = "  "        Dim Max_Volume As Double        Max_Volume = 0        Dim Writeto As Single                ws.Cells(1, 9).Value = "Ticker"        ws.Cells(1, 10).Value = "Yearly Change"        ws.Cells(1, 11).Value = "Percent Change"        ws.Cells(1, 12).Value = "Total Stock Volume"        ws.Cells(1, 16).Value = "Ticker"        ws.Cells(1, 17).Value = "Value"                ws.Range("O2") = "Greatest % Increase"        ws.Range("O3") = "Greatest % Decrease"        ws.Range("O4") = "Greatest Total Volume"        LastRow = ws.Cells(Rows.Count, 1).End(xlUp).Row        SummaryRow = 2        TotalVolume = 0        For i = 2 To LastRow            TotalVolume = TotalVolume + ws.Cells(i, 7).Value            If (ws.Cells(i - 1, 1).Value <> ws.Cells(i, 1).Value) Or (i = 2) Then                OpeningPrice = ws.Cells(i, 3).Value                Ticker = ws.Cells(i, 1).Value                TotalVolume = ws.Cells(i, 7).Value            End If                        If ws.Cells(i + 1, 1).Value <> ws.Cells(i, 1).Value Then                                ClosingPrice = ws.Cells(i, 6).Value                YearlyChange = ClosingPrice - OpeningPrice                                Writeto = 1                                If OpeningPrice <> 0 Then                    PercentChange = (YearlyChange / OpeningPrice)                Else                    PercentChange = 0                End If              End If              If Writeto = 1 Then                ws.Cells(SummaryRow, 9).Value = Ticker                ws.Cells(SummaryRow, 10).Value = YearlyChange                ws.Cells(SummaryRow, 11).Value = PercentChange                ws.Cells(SummaryRow, 12).Value = TotalVolume  ' Set the total volume for the current Ticker                ws.Cells(SummaryRow, 11).NumberFormat = "0.00%"                                If YearlyChange > 0 Then                    ws.Cells(SummaryRow, 10).Interior.Color = RGB(0, 255, 0)                ElseIf YearlyChange < 0 Then                    ws.Cells(SummaryRow, 10).Interior.Color = RGB(255, 0, 0)                End If                Writeto = 0                TotalVolume = 0  ' Reset total volume for the next Ticker                SummaryRow = SummaryRow + 1                End If                                           Next i                LastRowI = ws.Cells(Rows.Count, 9).End(xlUp).Row        GreatVol = ws.Cells(2, 12).Value        GreatIncr = ws.Cells(2, 11).Value        GreatDecr = ws.Cells(2, 11).Value                    For i = 2 To LastRowI                            'For Greatest Total Volume                If ws.Cells(i, 12).Value > GreatVol Then                GreatVol = ws.Cells(i, 12).Value                ws.Cells(4, 16).Value = ws.Cells(i, 9).Value                            Else: GreatVol = GreatVol                            End If                            'For Greatest Increase                If ws.Cells(i, 11).Value > GreatIncr Then                GreatIncr = ws.Cells(i, 11).Value                ws.Cells(2, 16).Value = ws.Cells(i, 9).Value                            Else: GreatIncr = GreatIncr                            End If                            'For Greatest Decrease                If ws.Cells(i, 11).Value < GreatDecr Then                GreatDecr = ws.Cells(i, 11).Value                ws.Cells(3, 16).Value = ws.Cells(i, 9).Value                            Else                            GreatDecr = GreatDecr                            End If                        'Take down summary results in worksheet            ws.Cells(2, 17).Value = Format(GreatIncr, "Percent")            ws.Cells(3, 17).Value = Format(GreatDecr, "Percent")            ws.Cells(4, 17).Value = Format(GreatVol, "Scientific")                        Next i                     Next wsEnd Sub